<script>
  let currentKey = "";

  document.getElementById('generateBtn').addEventListener('click', async () => {
    const keyBox = document.getElementById('keyBox');
    keyBox.innerText = "লোড হচ্ছে...";

    try {
      const response = await fetch('https://adfreej.netlify.app/.netlify/functions/get-key', { cache: 'no-store' });
      if (!response.ok) throw new Error("সার্ভার এরর: " + response.status);

      const data = await response.json();
      currentKey = data.key;

      const now = Date.now();
      if (data.expiresAt && now > data.expiresAt) {
        keyBox.innerText = "কী এক্সপায়ার হয়ে গেছে!\nনতুন জেনারেট করুন";
        document.getElementById('copyBtn').style.display = 'none';
      } else {
        keyBox.innerText = currentKey + "\n(৬ ঘণ্টা পর এক্সপায়ার হবে)";
        document.getElementById('copyBtn').style.display = 'block';
      }
    } catch (error) {
      keyBox.innerText = "সমস্যা: " + error.message;
      document.getElementById('copyBtn').style.display = 'none';
    }
  });

  document.getElementById('copyBtn').addEventListener('click', () => {
    if (currentKey) {
      navigator.clipboard.writeText(currentKey).then(() => {
        const toast = document.getElementById('toast');
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2500);
      }).catch(() => {
        alert("কপি করতে সমস্যা হয়েছে");
      });
    }
  });
</script>
